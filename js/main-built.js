define("map",["game"],function(e){var t={width:0,height:0,tileWidth:0,tileHeight:0,grids:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],draw:function(){t.width=require("game").canvases.map.width,t.height=require("game").canvases.map.height,t.tileWidth=t.width/t.grids[0].length,t.tileHeight=t.height/t.grids.length;for(var e=0;e<t.grids.length;e++)for(var n=0;n<t.grids[e].length;n++)t.grids[e][n]===1?require("game").ctx.map.fillStyle="black":require("game").ctx.map.fillStyle="white",require("game").ctx.map.fillRect(t.tileWidth*n,t.tileHeight*e,t.tileWidth+1,t.tileHeight+1),require("game").ctx.map.fillStyle="white"}};return t}),define("keys",[],function(){var e={up:87,down:83,right:68,left:65,fire:"mousedown"};return e}),define("trig",["game","game","game","game","game","game","game","game","game","game","game","game","game"],function(){var e={normaliseDeg:function(e){while(e>=360)e-=360;while(e<0)e+=360;return e},normaliseRad:function(e){var t=360*(Math.PI/180);while(e<0)e+=t;while(e>=t)e=t-e;return e},degRad:function(e){return e*(Math.PI/180)},radDeg:function(e){return e*(180/Math.PI)},lineIntersect:function(e,t,n,r,i,s,o,u,a,f){require("game").debug&&(require("game").ctx.debug.strokeStyle=a,require("game").ctx.debug.beginPath(),require("game").ctx.debug.moveTo(n,r),require("game").ctx.debug.lineTo(e,t),require("game").ctx.debug.stroke(),require("game").ctx.debug.strokeStyle="#000",require("game").ctx.debug.strokeStyle=f,require("game").ctx.debug.beginPath(),require("game").ctx.debug.moveTo(o,u),require("game").ctx.debug.lineTo(i,s),require("game").ctx.debug.stroke(),require("game").ctx.debug.strokeStyle="#000");var l=(s-u)*(e-n)-(i-o)*(t-r),c=(i-o)*(r-u)-(s-u)*(n-o),h=(e-n)*(r-u)-(t-r)*(n-o);c=Math.round(c*100)/100/l,h=Math.round(h*100)/100/l;var p=c>=0&&c<=1&&h>=0&&h<=1;return p?!0:!1},distance:function(e,t,n,r){var i=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2));return i},radTo:function(e,t,n,r){var i=Math.atan2(r-t,n-e);return i},degTo:function(e,t,n,r){var i=this.radTo(e,t,n,r),s=this.radDeg(i);return i},randomFromTo:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}};return e}),define("collision",["map","trig"],function(e,t){var n={grid:function(){},agent:function(){}};return n.grid=function(t,n){var r=Math.floor(t/e.tileWidth),i=Math.floor(n/e.tileHeight);if(n>e.height||t>e.width||t<0||n<0)return!0;var s=e.grids[i][r];return s!==0?!0:!1},n.agents=function(e,n,r,i){var s=require("game").mobs.slice(0);s.push(require("game").Player);var o=[];for(var u=0;u<s.length;u++)t.distance(e,n,s[u].pos.x,s[u].pos.y)<100&&o.push(s[u]);for(var u=0;u<o.length;u++){var a=o[u];require("game").debug;if(!(e-r/2>a.pos.x-a.pos.w/2+a.pos.w||n-i/2>a.pos.y-a.pos.h/2+a.pos.h||a.pos.x-a.pos.w/2>e-r/2+r||a.pos.y-a.pos.h/2>n-i/2+i))return!0}return!1},n.projectileBounding=function(e,n){return t.distance(e.pos.x,e.pos.y,n.pos.x,n.pos.y)<100?e.pos.x-e.pos.w/2>n.pos.x+n.pos.w/2||e.pos.y-e.pos.h/2>n.pos.y+n.pos.h/2||n.pos.x-n.pos.w/2>e.pos.x+e.pos.w/2||n.pos.y-n.pos.h/2>e.pos.y+e.pos.h/2?!1:!0:!1},n.projectile=function(e,n){var r=Math.SQRT2,i=e.pos.h*r/2,s=n.pos.h*r/2,o=t.normaliseRad(e.dir+t.degRad(135)),u=t.normaliseRad(e.dir-t.degRad(135)),a=t.normaliseRad(e.dir+t.degRad(45)),f=t.normaliseRad(e.dir-t.degRad(45)),l=t.normaliseRad(n.dir+t.degRad(135)),c=t.normaliseRad(n.dir-t.degRad(135)),h=t.normaliseRad(n.dir+t.degRad(45)),p=t.normaliseRad(n.dir-t.degRad(45)),d=e.lastPos.x+Math.cos(u)*i,v=e.lastPos.y+Math.sin(u)*i,m=e.lastPos.x+Math.cos(o)*i,g=e.lastPos.y+Math.sin(o)*i,y=e.pos.x+Math.cos(f)*i,b=e.pos.y+Math.sin(f)*i,w=e.pos.x+Math.cos(a)*i,E=e.pos.y+Math.sin(a)*i,S=n.lastPos.x+Math.cos(c)*s,x=n.lastPos.y+Math.sin(c)*s,T=n.lastPos.x+Math.cos(l)*s,N=n.lastPos.y+Math.sin(l)*s,C=n.pos.x+Math.cos(p)*s,k=n.pos.y+Math.sin(p)*s,L=n.pos.x+Math.cos(h)*s,A=n.pos.y+Math.sin(h)*s;if(t.lineIntersect(y,b,d,v,C,k,S,x,"#0f0","#00f"))return!0;if(t.lineIntersect(w,E,m,g,L,A,T,N,"#F00","#FF0"))return!0;var O=n.pos.x+Math.cos(n.dir)*(n.pos.h/2),M=n.pos.y+Math.sin(n.dir)*(n.pos.h/2),_=O+Math.cos(n.dir-t.degRad(90))*(n.pos.h/2),D=M+Math.sin(n.dir-t.degRad(90))*(n.pos.h/2),P=n.dir+t.degRad(90),H=_+Math.cos(P)*n.pos.w,B=D+Math.sin(P)*n.pos.h;if(t.lineIntersect(e.pos.x,e.pos.y,e.lastPos.x,e.lastPos.y,_,D,H,B,"#f00","#00f"))return!0;var j=n.pos.x-Math.cos(n.dir)*(n.pos.w/2),F=n.pos.y-Math.sin(n.dir)*(n.pos.h/2),_=j+Math.cos(n.dir-t.degRad(90))*(n.pos.w/2),D=F+Math.sin(n.dir-t.degRad(90))*(n.pos.h/2),P=n.dir+t.degRad(90),H=_+Math.cos(P)*n.pos.w,B=D+Math.sin(P)*n.pos.h;return t.lineIntersect(e.pos.x,e.pos.y,e.lastPos.x,e.lastPos.y,_,D,H,B,"#f00","#00f")?!0:!1},n}),define("agent",["collision","trig"],function(e,t){var n={Collision:e,Trig:t,type:"Agent",color:"black",lastPos:{x:0,y:0,w:0,h:0},toPos:{x:0,y:0,w:0,h:0},pos:{x:0,y:0,w:0,h:0},dir:0,xSpeed:0,ySpeed:0,alive:0,lastHit:0,target:null,lastShot:0,health:2,maxHealth:2,ammo:0,maxSpeed:0,reloadSpeed:0,init:function(e){this.pos=e,this.lastPos=e,require("game").agents.push(this)},update:function(){this.move(this.toPos),this.lastPos={x:this.pos.x,y:this.pos.y,w:this.pos.w,h:this.pos.h},this.toPos={x:0,y:0,w:0,h:0}},draw:function(){this.lastHit>require("game").loopCounter-5?require("game").ctx.game.fillStyle="blue":require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.fillRect(this.pos.x-this.pos.w/2,this.pos.y-this.pos.h/2,this.pos.w,this.pos.h),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},setMove:function(e){this.toPos.x+=e.x,this.toPos.y+=e.y},move:function(t){e.grid(this.pos.x+t.x,this.pos.y+t.y)||(this.pos.x+=t.x,this.pos.y+=t.y)},setTarget:function(e){},shoot:function(e,t,n,r){var i=Object.create(t);i.init({x:this.pos.x,y:this.pos.y,w:5,h:5},e,"todo",this,n,r),delete i},hit:function(e){this.health-=e,this.lastHit=require("game").loopCounter,this.health<=0&&this.die()},die:function(){var e=require("game").agents.indexOf(this);require("game").agents.splice(e,1)}};return n}),define("square",["agent"],function(e){var t=Object.create(e);return t.init=function(t){this.dir=Math.random()*-6.28,this.maxSpeed=2,this.type="Square",this.health=3,this.damage=4,this.target=require("game").Player,e.init.call(this,t),require("game").mobs.push(this)},t.update=function(){this.Collision.projectileBounding(this,this.target)&&(this.target.hit(this.damage),this.die()),e.update.call(this)},t.setMove=function(t){e.setMove.call(this,t)},t.move=function(t){var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.Collision.grid(this.pos.x+n,this.pos.y+r)?(this.Collision.grid(this.pos.x,this.pos.y+r)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x+n,this.pos.y-r)),this.Collision.grid(this.pos.x+n,this.pos.y)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x-n,this.pos.y+r)),this.toPos.x+=Math.cos(this.dir)*this.maxSpeed,this.toPos.y+=Math.sin(this.dir)*this.maxSpeed):(this.toPos.x+=n,this.toPos.y+=r),e.move.call(this,t)},t.draw=function(){e.draw.call(this)},t.shoot=function(){e.shoot.call(this)},t.die=function(){var t=require("game").mobs.indexOf(this);require("game").mobs.splice(t,1),e.die.call(this)},t}),define("projectile",["agent"],function(e){var t=Object.create(e);return t.init=function(t,n,r,i,s,o){e.init.call(this,t),this.dir=n,this.maxSpeed=s,this.damage=o,this.type="Projectile",this.firedBy=i,this.health=1,require("game").projectiles.push(this)},t.update=function(){e.update.call(this)},t.move=function(e){var t=Math.cos(this.dir)*this.maxSpeed,n=Math.sin(this.dir)*this.maxSpeed;this.Collision.grid(this.pos.x+t,this.pos.y+n)?this.die():(this.pos.x+=t,this.pos.y+=n)},t.draw=function(){e.draw.call(this)},t.shoot=function(){return console.log("this shouldnt be. projectile:shoot"),null},t.die=function(){var t=require("game").projectiles.indexOf(this);require("game").projectiles.splice(t,1),e.die.call(this)},t}),define("triangle",["agent","projectile"],function(e,t){var n=Object.create(e);return n.init=function(t){this.dir=Math.random()*-6.28,this.maxSpeed=.5,this.type="Triangle",this.health=2,this.target=require("game").Player,this.reloadSpeed=this.Trig.randomFromTo(150,200),this.damage=4,e.init.call(this,t),require("game").mobs.push(this)},n.update=function(){e.update.call(this),this.lastShot<require("game").loopCounter-this.reloadSpeed&&this.shoot()},n.setMove=function(t){e.setMove.call(this,t)},n.move=function(t){this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.Collision.grid(this.pos.x+n,this.pos.y+r)?(this.Collision.grid(this.pos.x,this.pos.y+r)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x+n,this.pos.y-r)),this.Collision.grid(this.pos.x+n,this.pos.y)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x-n,this.pos.y+r)),this.toPos.x+=Math.cos(this.dir)*this.maxSpeed,this.toPos.y+=Math.sin(this.dir)*this.maxSpeed):(this.toPos.x+=n,this.toPos.y+=r),e.move.call(this,t)},n.draw=function(){this.lastHit>require("game").loopCounter-5?require("game").ctx.game.fillStyle="blue":require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.beginPath(),require("game").ctx.game.moveTo(this.pos.x,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y+this.pos.h/2),require("game").ctx.game.fill(),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},n.shoot=function(){var n=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);e.shoot.call(this,n,t,4,4),this.lastShot=require("game").loopCounter},n.die=function(){var t=require("game").mobs.indexOf(this);require("game").mobs.splice(t,1),e.die.call(this)},n}),define("pentagon",["agent","projectile"],function(e,t){var n=Object.create(e);return n.init=function(t){this.dir=Math.random()*-6.28,this.maxSpeed=.3,this.type="Pentagon",this.health=4,this.target=require("game").Player,this.reloadSpeed=200,e.init.call(this,t),require("game").mobs.push(this)},n.update=function(){e.update.call(this),this.lastShot<require("game").loopCounter-this.reloadSpeed&&this.shoot()},n.setMove=function(t){e.setMove.call(this,t)},n.move=function(t){var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.Collision.grid(this.pos.x+n,this.pos.y+r)?(this.Collision.grid(this.pos.x,this.pos.y+r)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x+n,this.pos.y-r)),this.Collision.grid(this.pos.x+n,this.pos.y)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x-n,this.pos.y+r)),this.toPos.x+=Math.cos(this.dir)*this.maxSpeed,this.toPos.y+=Math.sin(this.dir)*this.maxSpeed):(this.toPos.x+=n,this.toPos.y+=r),e.move.call(this,t)},n.draw=function(){this.lastHit>require("game").loopCounter-5?require("game").ctx.game.fillStyle="blue":require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.beginPath(),require("game").ctx.game.moveTo(this.pos.x,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2/2,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2/2,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y),require("game").ctx.game.fill(),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},n.shoot=function(){var n=1.256,r=n;e.shoot.call(this,r,t,1,4);var r=n*2;e.shoot.call(this,r,t,1,4);var r=n*3;e.shoot.call(this,r,t,1,4);var r=n*4;e.shoot.call(this,r,t,1,4);var r=n*5;e.shoot.call(this,r,t,1,4),this.lastShot=require("game").loopCounter},n.die=function(){var t=require("game").mobs.indexOf(this);require("game").mobs.splice(t,1),e.die.call(this)},n}),define("circle",["agent","projectile"],function(e,t){var n=Object.create(e);return n.init=function(t){this.dir=Math.random()*-6.28,this.maxSpeed=3,this.type="Circle",this.health=2,this.target=require("game").Player,this.reloadSpeed=this.Trig.randomFromTo(50,70),e.init.call(this,t),require("game").mobs.push(this)},n.update=function(){e.update.call(this),this.lastShot<require("game").loopCounter-this.reloadSpeed&&this.shoot()},n.setMove=function(t){e.setMove.call(this,t)},n.move=function(t){this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.Collision.grid(this.pos.x+n,this.pos.y+r)?(this.Collision.grid(this.pos.x,this.pos.y+r)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x+n,this.pos.y-r)),this.Collision.grid(this.pos.x+n,this.pos.y)&&(this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.pos.x-n,this.pos.y+r)),this.toPos.x+=Math.cos(this.dir)*this.maxSpeed,this.toPos.y+=Math.sin(this.dir)*this.maxSpeed):(this.toPos.x+=n,this.toPos.y+=r),e.move.call(this,t)},n.draw=function(){this.lastHit>require("game").loopCounter-5?require("game").ctx.game.fillStyle="blue":require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.beginPath(),require("game").ctx.game.arc(this.pos.x,this.pos.y,this.pos.w/2,0,Math.PI*2,!0),require("game").ctx.game.fill(),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},n.shoot=function(){var n=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);e.shoot.call(this,n,t,20,4),this.lastShot=require("game").loopCounter},n.die=function(){var t=require("game").mobs.indexOf(this);require("game").mobs.splice(t,1),e.die.call(this)},n}),define("pu_maxAmmo",["agent"],function(e){var t=Object.create(e);return t.init=function(t){this.dir=0,this.maxSpeed=.5,this.type="pu_maxAmmo",this.target=require("game").Player,this.health=1,this.effect="maxAmmo",this.bonus=10,this.color="#0f0",e.init.call(this,t),require("game").powerups.push(this)},t.update=function(){this.Collision.projectileBounding(this,this.target)&&(this.target.powerup(this),this.die()),e.update.call(this)},t.setMove=function(t){e.setMove.call(this,t)},t.move=function(t){if(this.Trig.distance(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y)<100){this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.toPos.x+=n,this.toPos.y+=r}e.move.call(this,t)},t.draw=function(){require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.beginPath(),require("game").ctx.game.moveTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.fill(),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},t.shoot=function(){e.shoot.call(this)},t.hit=function(){return null},t.die=function(){var t=require("game").powerups.indexOf(this);require("game").powerups.splice(t,1),e.die.call(this)},t}),define("pu_maxSpeed",["agent"],function(e){var t=Object.create(e);return t.init=function(t){this.dir=0,this.maxSpeed=.5,this.type="pu_maxSpeed",this.target=require("game").Player,this.health=1,this.effect="maxSpeed",this.bonus=.5,this.color="#00f",e.init.call(this,t),require("game").powerups.push(this)},t.update=function(){this.Collision.projectileBounding(this,this.target)&&(this.target.powerup(this),this.die()),e.update.call(this)},t.setMove=function(t){e.setMove.call(this,t)},t.move=function(t){if(this.Trig.distance(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y)<100){this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.toPos.x+=n,this.toPos.y+=r}e.move.call(this,t)},t.draw=function(){require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.beginPath(),require("game").ctx.game.moveTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.fill(),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},t.shoot=function(){e.shoot.call(this)},t.hit=function(){return null},t.die=function(){var t=require("game").powerups.indexOf(this);require("game").powerups.splice(t,1),e.die.call(this)},t}),define("pu_regenHealth",["agent"],function(e){var t=Object.create(e);return t.init=function(t){this.dir=0,this.maxSpeed=.5,this.type="pu_regenHealth",this.target=require("game").Player,this.health=1,this.effect="regenHealth",this.bonus=.005,this.color="#f00",e.init.call(this,t),require("game").powerups.push(this)},t.update=function(){this.Collision.projectileBounding(this,this.target)&&(this.target.powerup(this),this.die()),e.update.call(this)},t.setMove=function(t){e.setMove.call(this,t)},t.move=function(t){if(this.Trig.distance(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y)<100){this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.toPos.x+=n,this.toPos.y+=r}e.move.call(this,t)},t.draw=function(){require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.beginPath(),require("game").ctx.game.moveTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.fill(),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},t.shoot=function(){e.shoot.call(this)},t.hit=function(){return null},t.die=function(){var t=require("game").powerups.indexOf(this);require("game").powerups.splice(t,1),e.die.call(this)},t}),define("pu_regenAmmo",["agent"],function(e){var t=Object.create(e);return t.init=function(t){this.dir=0,this.maxSpeed=.5,this.type="pu_regenHealth",this.target=require("game").Player,this.health=1,this.effect="regenAmmo",this.bonus=.3,this.color="#000",e.init.call(this,t),require("game").powerups.push(this)},t.update=function(){this.Collision.projectileBounding(this,this.target)&&(this.target.powerup(this),this.die()),e.update.call(this)},t.setMove=function(t){e.setMove.call(this,t)},t.move=function(t){if(this.Trig.distance(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y)<100){this.dir=this.Trig.radTo(this.pos.x,this.pos.y,this.target.pos.x,this.target.pos.y);var n=Math.cos(this.dir)*this.maxSpeed,r=Math.sin(this.dir)*this.maxSpeed;this.toPos.x+=n,this.toPos.y+=r}e.move.call(this,t)},t.draw=function(){require("game").ctx.game.fillStyle=this.color,require("game").ctx.game.beginPath(),require("game").ctx.game.moveTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x-this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/2),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y+this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/2,this.pos.y-this.pos.h/6),require("game").ctx.game.lineTo(this.pos.x+this.pos.w/6,this.pos.y-this.pos.h/6),require("game").ctx.game.fill(),require("game").ctx.game.fillStyle=require("game").defaultFillStyle},t.shoot=function(){e.shoot.call(this)},t.hit=function(){return null},t.die=function(){var t=require("game").powerups.indexOf(this);require("game").powerups.splice(t,1),e.die.call(this)},t}),define("levels",["square","triangle","pentagon","circle","pu_maxAmmo","pu_maxSpeed","pu_regenHealth","pu_regenAmmo"],function(e,t,n,r,i,s,o,u){var a=[{mobs:[{type:"NEVER USED",count:5}]},{mobs:[{type:e,count:1}],powerups:[{type:i,count:1}]},{mobs:[{type:e,count:10}],powerups:[{type:s,count:1},{type:i,count:1}]},{mobs:[{type:e,count:5},{type:t,count:3}],powerups:[{type:s,count:1}]},{mobs:[{type:r,count:1},{type:t,count:5}],powerups:[{type:i,count:1},{type:s,count:1}]},{mobs:[{type:r,count:2},{type:t,count:10}],powerups:[{type:s,count:1},{type:u,count:1}]},{mobs:[{type:e,count:10},{type:n,count:5}],powerups:[{type:s,count:1},{type:i,count:1}]},{mobs:[{type:e,count:10},{type:n,count:5},{type:r,count:4}],powerups:[{type:i,count:1},{type:o,count:1}]},{mobs:[{type:e,count:10},{type:n,count:5},{type:r,count:4}],powerups:[{type:s,count:1},{type:i,count:1},{type:u,count:1}]},{mobs:[{type:e,count:10},{type:t,count:10},{type:n,count:10},{type:r,count:4}],powerups:[{type:s,count:1},{type:u,count:1},{type:o,count:1}]},{mobs:[{type:e,count:50}],powerups:[{type:s,count:2},{type:i,count:2},{type:o,count:2}]},{mobs:[{type:t,count:20},{type:r,count:4}],powerups:[{type:o,count:2}]},{mobs:[{type:t,count:15},{type:n,count:10},{type:r,count:5}],powerups:[{type:o,count:2}]},{mobs:[{type:n,count:20},{type:e,count:20},{type:r,count:6}],powerups:[{type:s,count:2},{type:o,count:1}]},{mobs:[{type:t,count:30},{type:e,count:20},{type:r,count:6}],powerups:[{type:s,count:1},{type:o,count:1}]},{mobs:[{type:n,count:30},{type:t,count:30},{type:e,count:30},{type:r,count:10}],powerups:[{type:s,count:2},{type:o,count:2},{type:i,count:2}]}];return a}),define("input",["game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game","game"],function(){var e={addKey:function(){},removeKey:function(){},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},output:function(){},mouseE:null};return e.addKey=function(e){require("game").keysPressed[e.which]=!0},e.removeKey=function(e){delete require("game").keysPressed[e.which]},e.mouseMove=function(e){require("game").Player.setMouse(e.clientX-require("game").ctx.game.canvas.offsetLeft,e.clientY-require("game").ctx.game.canvas.offsetTop)},e.mouseDown=function(e){require("game").keysPressed.mousedown=!0},e.mouseUp=function(e){delete require("game").keysPressed.mousedown},e.output=function(){require("game").keysPressed.hasOwnProperty(require("game").Keys.right)?require("game").Player.setMove({x:require("game").Player.maxSpeed}):!require("game").keysPressed.hasOwnProperty(require("game").Keys.left),require("game").keysPressed.hasOwnProperty(require("game").Keys.left)?require("game").Player.setMove({x:-require("game").Player.maxSpeed}):!require("game").keysPressed.hasOwnProperty(require("game").Keys.right),require("game").keysPressed.hasOwnProperty(require("game").Keys.up)?require("game").Player.setMove({y:-require("game").Player.maxSpeed}):!require("game").keysPressed.hasOwnProperty(require("game").Keys.down),require("game").keysPressed.hasOwnProperty(require("game").Keys.down)?require("game").Player.setMove({y:require("game").Player.maxSpeed}):!require("game").keysPressed.hasOwnProperty(require("game").Keys.up),require("game").keysPressed.hasOwnProperty(require("game").Keys.fire)&&require("game").Player.setMouseClick()},e}),define("player",["agent","projectile"],function(e,t){var n=Object.create(e);return n.init=function(t){this.type="Player",this.reloadSpeed=.3,this.health=10,this.pos.w=this.health,this.pos.h=this.health,this.maxHealth=30,this.regenHealth=.01,this.ammo=10,this.regenAmmo=.1,this.maxAmmo=10,this.maxSpeed=1,e.init.call(this,t)},n.update=function(){this.toPos.x===0&&this.toPos.y===0&&this.ammo<this.maxAmmo&&(this.ammo+=this.regenAmmo),this.lastShot<require("game").loopCounter-5&&this.health<this.maxHealth&&(this.health+=this.regenHealth,this.pos.w+=this.regenHealth,this.pos.h+=this.regenHealth),e.update.call(this)},n.setMouse=function(e,t){this.dir=this.Trig.radTo(this.pos.x,this.pos.y,e,t)},n.setMouseClick=function(){this.lastShot<require("game").loopCounter-this.reloadSpeed&&this.shoot()},n.setMove=function(e){e.x!==undefined&&(this.toPos.x+=e.x),e.y!==undefined&&(this.toPos.y+=e.y)},n.move=function(t){e.move.call(this,t)},n.draw=function(){var t=this.ammo/10,n=5,r=10,i=3;for(var s=0;s<t;s++)require("game").ctx.game.fillRect(this.pos.x-this.maxHealth/2-20-r/2,this.pos.y-(n/2+s*(n+i)),r,n);require("game").ctx.game.strokeRect(this.pos.x-this.maxHealth/2,this.pos.y-this.maxHealth/2,this.maxHealth,this.maxHealth),e.draw.call(this)},n.shoot=function(e){if(this.ammo<1)return;var n=this.dir,r=Object.create(t);r.init({x:this.pos.x,y:this.pos.y,w:5,h:5},n,"todo",this,10,1),delete r,this.lastShot=require("game").loopCounter,this.ammo--},n.hit=function(t){this.pos.w-=t,this.pos.h-=t,e.hit.call(this,t)},n.powerup=function(e){this[e.effect]+=e.bonus},n.die=function(){require("game").playerDead(),console.log("you dead")},n}),define("game",["map","keys","levels","input","collision","trig","agent","player","square","triangle","pentagon"],function(e,t,n,r,i,s,o,u,a,f,l){var c={running:!0,debug:!0,fps:25,canvases:{},ctx:{},Keys:t,keysPressed:{},assets:{},levels:n,agents:[],mobs:[],projectiles:[],powerups:[],Player:null,init:function(){},loop:function(){},Input:r,update:function(){},draw:function(){},Map:e,Agent:o,Collision:i,Trig:s,loopCounter:0,currentLevel:0,powerupChance:.99,maxPowerupsAlive:3,leftOffset:0,defaultFillStyle:"black",canvases:{map:document.getElementById("map_canvas"),game:document.getElementById("game_canvas"),info:document.getElementById("info_canvas"),debug:document.getElementById("debug_canvas")},preinit:function(){this.debug&&console.log("preinit")},ctx:{},init:function(e){this.debug&&console.log("init"),this.ctx={map:this.canvases.map.getContext("2d"),game:this.canvases.game.getContext("2d"),info:this.canvases.info.getContext("2d"),debug:this.canvases.debug.getContext("2d")},window.innerWidth<window.innerHeight?(c.Map.width=window.innerWidth,c.Map.height=window.innerWidth-10):(c.Map.height=window.innerHeight-10,c.Map.width=window.innerHeight),this.canvases.map.width=this.Map.width,this.canvases.map.height=this.Map.height,this.canvases.game.width=this.Map.width,this.canvases.game.height=this.Map.height,this.canvases.info.width=this.Map.width,this.canvases.info.height=this.Map.height,this.debug&&(this.canvases.debug.width=this.Map.width,this.canvases.debug.height=this.Map.height),this.leftOffset=window.innerWidth/2-this.canvases.map.width/2,console.log(this.leftOffset),this.canvases.map.style.position="absolute",this.canvases.map.style.top="0",this.canvases.map.style.left=this.leftOffset+"px",this.canvases.game.style.position="absolute",this.canvases.game.style.top="0",this.canvases.game.style.left=this.leftOffset+"px",this.canvases.info.style.position="absolute",this.canvases.info.style.top="0",this.canvases.info.style.left=this.leftOffset+"px",this.debug&&(this.canvases.debug.style.position="absolute",this.canvases.debug.style.top="0",this.canvases.debug.style.left=this.leftOffset+"px"),this.Map.draw(),this.Player=Object.create(u),this.Player.init({x:this.Map.width/2,y:this.Map.height/2,w:10,h:10}),e()},loop:function(){this.running&&(this.thisRenderTime=Date.now(),this.frameTime=(this.thisRenderTime-this.lastRenderTime)/1e3,this.update(),this.draw(),this.level(),this.loopCounter++,c.lastRenderTime=c.thisRenderTime,window.requestAnimationFrame(this.loop.bind(this)))},update:function(e){this.Input.output();for(var t in this.agents)this.agents[t].update();var n=this.mobs;for(var r in this.projectiles){if(this.projectiles[r].firedBy!==this.Player)continue;var i=!1,s=null;for(var o in n){if(this.projectiles[r].firedBy===n[o])continue;if(this.Collision.projectileBounding(this.projectiles[r],n[o])){s=n[o],i=!0;continue}}i&&(s.hit(this.projectiles[r].damage),this.projectiles[r].die())}for(var r in this.projectiles){if(this.projectiles[r].firedBy===this.Player)continue;this.Collision.projectileBounding(this.projectiles[r],this.Player)&&(this.Player.hit(this.projectiles[r].damage),this.projectiles[r].die())}},draw:function(e){this.ctx.game.clearRect(0,0,this.Map.width,this.Map.height),this.debug;for(var t in this.agents)this.agents[t].draw()},level:function(e){if(this.mobs.length>0)return;this.currentLevel++,this.ctx.info.clearRect(0,0,this.Map.width,this.Map.height);if(this.levels[this.currentLevel]===undefined){this.victory();return}var t=this.levels[this.currentLevel];for(mob in t.mobs)for(var n=0;n<t.mobs[mob].count;n++){var r=Math.random()*4;if(r<1)var i=s.randomFromTo(this.Map.tileWidth,this.Map.tileWidth*3),o=s.randomFromTo(this.Map.tileHeight,this.Map.tileHeight*3);else if(r<2)var i=s.randomFromTo(this.Map.width-this.Map.tileWidth*3,this.Map.width-this.Map.tileWidth),o=s.randomFromTo(this.Map.tileHeight,this.Map.tileHeight*3);else if(r<3)var i=s.randomFromTo(this.Map.tileWidth,this.Map.tileWidth*3),o=s.randomFromTo(this.Map.height-this.Map.tileHeight,this.Map.height-this.Map.tileHeight*3);else var i=s.randomFromTo(this.Map.width-this.Map.tileWidth*3,this.Map.width-this.Map.tileWidth),o=s.randomFromTo(this.Map.height-this.Map.tileHeight,this.Map.height-this.Map.tileHeight*3);this[t.mobs[mob].type]=Object.create(t.mobs[mob].type),this[t.mobs[mob].type].init({x:i,y:o,w:20,h:20})}for(powerup in t.powerups)this[t.powerups[powerup].type]=Object.create(t.powerups[powerup].type),this[t.powerups[powerup].type].init({x:s.randomFromTo(100,600),y:s.randomFromTo(100,600),w:20,h:20});this.ctx.info.fillText("Level "+this.currentLevel,this.Map.tileWidth*2,this.Map.tileHeight*2)},victory:function(){console.log("GAME WON");var e="Win.",t=this.ctx.info.measureText(e);this.ctx.info.fillStyle="white",this.ctx.info.fillRect(this.Map.width/2-t.width/2-10,this.Map.height/2-10,t+20,40),this.ctx.info.fillStyle="black",this.ctx.info.fillText(e,this.Map.width/2-t.width/2,this.Map.height/2),this.running=!1},playerDead:function(){console.log("GAME LOST");var e="Lose.",t=this.ctx.info.measureText(e);this.ctx.info.fillStyle="white",this.ctx.info.fillRect(this.Map.width/2-t.width/2-10,this.Map.height/2-10,t.width+20,20),this.ctx.info.fillStyle="black",this.ctx.info.fillText(e,this.Map.width/2-t.width/2,this.Map.height/2),this.running=!1}};return c}),require(["game"],function(e){e.debug&&console.log(e),function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e}(),e.preinit(),e.init(function(){window.addEventListener("keydown",e.Input.addKey,!0),window.addEventListener("keyup",e.Input.removeKey,!0),window.addEventListener("mousemove",e.Input.mouseMove,!0),window.addEventListener("mousedown",e.Input.mouseDown,!0),window.addEventListener("mouseup",e.Input.mouseUp,!0),console.log("game initialised."),e.loop()})}),define("main",function(){});